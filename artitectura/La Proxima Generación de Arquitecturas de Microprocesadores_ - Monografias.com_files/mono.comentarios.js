mono.CFG.URL_COMENTARIO_ENVIAR=mono.CFG.URL_MONO+"comentario/crear";mono.CFG.URL_COMENTARIO_DENUNCIAR=mono.CFG.URL_MONO+"comentario/denunciar";mono.CFG.URL_COMENTARIO_VOTAR=mono.CFG.URL_MONO+"comentario/votar";mono.CFG.URL_PAGINA_SOLICITAR=mono.CFG.URL_MONO+"comentario/paginador/";mono.comentarios={setHandlers:function(){if(mono.TEMP.usuario){$("#cont-form-comentario").show()}else{$("#js-inicia-primero").show()}$("#form-enviar-comentario button.submit").attr("disabled","disabled");var a;$(":input[name='comentario-texto']").bind("keydown",function(c){var b=$(this);clearTimeout(a);a=setTimeout(function(){var d=b.val();if(!d){$("#form-enviar-comentario button.submit").attr("disabled","disabled")}else{$("#form-enviar-comentario button.submit").removeAttr("disabled")}},500)});$("#form-enviar-comentario").bind("submit",function(d){d.preventDefault();var b=$(this);b.desactivar();$("#js-comentario-error").hide();var c=$(":input[name='comentario-texto']").val();var f=mono.util.sanearTexto(c);$(":input[name='comentario-texto']").val(f);$.ajax({url:mono.CFG.URL_COMENTARIO_ENVIAR,type:"POST",data:{mono_id:mono.temp_mono_id,comentario:f},success:function(e){$("#cont-form-comentario").hide();$("#js-comentario-publicado").show();$("#js-comentarios").empty().html(e);mono.denuncias.setHandlers();mono.calificacion.setHandlers();mono.paginacion.setHandlers()},error:function(g,h,e){switch(g.status){case 500:$("#js-comentario-error p").html(mono.msg.ERROR_500);$("#js-comentario-error").show();b.activar();break;case 403:$("#js-comentario-error p").html(mono.msg.ERROR_403_COMENTARIO);$("#js-comentario-error").show();b.activar();break;case 400:$("#js-comentario-error p").html(mono.msg.ERROR_400_COMENTARIO);$("#js-comentario-error").show();b.activar();break}}})});mono.console.log("comentarios.setHandlers listo.")}};mono.denuncias={setHandlers:function(){if(mono.TEMP.usuario){$(".js-denunciador").show()}$(".js-denunciar").bind("click",function(a){a.preventDefault();$el=$(this);comentarioId=$el.parents("li").attr("id").match(/js-comentario-([0-9]+)/)[1];if(confirm(mono.msg.CONFIRMA_DENUNCIA)){$.ajax({url:mono.CFG.URL_COMENTARIO_DENUNCIAR,type:"POST",data:{comentario_id:comentarioId},success:function(b){$el.parents(".js-denunciador").html(mono.msg.DENUNCIA_ENVIADA)},error:function(c,d,b){switch(c.status){case 500:alert(mono.msg.ERROR_500);break;case 403:alert(mono.msg.ERROR_403_DENUNCIA);break}}})}});mono.console.log("denuncias.setHandlers listo.")}};mono.calificacion={setHandlers:function(){if(mono.TEMP.usuario){$(".js-upvote, .js-downvote").bind("click",function(d){d.preventDefault();$(this).blur();var b=$(this);var c=$(this).parents("li");var a=c.attr("id").match(/js-comentario-([0-9]+)/)[1];var f=mono.util.getCookie("monoauth_username");if(f==null){return false}mono.console.log("verificando si existe: mono_"+f+"_"+a);if(mono.util.getCookie("mono_"+f+"_"+a)){alert(mono.msg.NO_VOTAR_DOBLE);return false}else{accion=b.hasClass("js-upvote")?"sumar":"restar";$.ajax({url:mono.CFG.URL_COMENTARIO_VOTAR,type:"POST",data:{comentario_id:a,accion:accion},success:function(g){mono.util.setCookie("mono_"+f+"_"+a,"true",true);diferencia=b.hasClass("js-upvote")?1:-1;var e=parseInt(b.siblings(".js-votos-actuales").text());var j=e+diferencia;b.siblings(".js-votos-actuales").text(j);var h=b.children("img").attr("src").match(/^(.*).gif$/)[1];var i=h+"_done.gif";b.children("img").attr("src",i);$(".js-upvote, .js-downvote",c).unbind("click").bind("click",function(k){k.preventDefault();$(this).blur();alert(mono.msg.NO_VOTAR_DOBLE)})},error:function(g,h,e){switch(g.status){case 500:alert(mono.msg.ERROR_500);break;case 403:alert(mono.msg.ERROR_403_DENUNCIA);break}}})}})}else{$(".js-upvote, .js-downvote").bind("click",function(a){a.preventDefault();$(this).blur();alert(mono.msg.ERROR_403_VOTAR)})}mono.console.log("calificacion.setHandlers listo.")}};mono.paginacion={setHandlers:function(){$(".js-pag-anterior, .js-pag-siguiente, .js-pag-nro").bind("click",function(c){c.preventDefault();$(this).blur();var a=$(this);mono.console.log("click - "+a.name);if(a.hasClass("js-pag-nro")){var b=parseInt(a.text())}else{var d=parseInt(a.siblings(".js-pag-actual").text());var b=a.hasClass("js-pag-anterior")?d-1:d+1}mono.paginacion.cargarPagina(b)});mono.console.log("paginacion.setHandlers listo.")},cargarPagina:function(a){$.ajax({url:mono.CFG.URL_PAGINA_SOLICITAR,type:"GET",data:{mono_id:mono.temp_mono_id,pagina:a},success:function(b){$("#js-comentarios").empty().html(b);mono.denuncias.setHandlers();mono.calificacion.setHandlers();mono.paginacion.setHandlers()},error:function(c,d,b){}})}};function setHandlerModalDownload(){var h=screen.width;var f=h/4;$("#colorbox").css("margin-left",f);var a=$("#js-modal-descarga").attr("href");var g=window.location.href.split("/")[5];var b=window.location.href.replace(g,"");var i=b+a;function e(){$("#publi-modal").append('<p style="float:left;width:100%;font-weight:bold;font-size:120%;margin-bottom:10px;"><a href="'+i+'" onClick="javascript: descartarModal();">Saltear paso (descargar archivo)</a></p><br /><iframe id="aoframe" name="aoframe" src="http://www.adoctopuss.com/scripts/offer_set.html?c=p32-a37-h844334&language=ES&rdr='+i+'" frameborder="0" width="600" scrolling="yes" style="overflow:visible;height:500px;float:left;"></iframe>')}function d(){$("#publi-modal").empty()}$("#js-modal-descarga").bind("click",function(j){j.preventDefault();e();$("#js-descargaModal").show()});$("#js-descargaModal-cerrar").bind("click",function(j){j.preventDefault();$("#js-descargaModal").hide();d()});$("#modalBackgroundOverlay").bind("click",function(j){j.preventDefault();$("#js-descargaModal").hide();d()});function c(){$("#js-descargaModal").hide();d()}}$(document).bind("ready",function(){mono.comentarios.setHandlers();mono.paginacion.cargarPagina(1);mono.console.log("mono.comentarios listo.")});